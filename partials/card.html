<div over-card close="nxt=''" nxt="nxt" mtd="mtd"  data-ng-show="nxt"></div>

<div class="card"  data-ng-class="{'lower':nxt}" data-ng-style="{borderColor:mtd.colorize(phrase.letters)}">

    <div data-ng-click=" nxt=''"
         data-ng-style="{backgroundColor:mtd.colorize(phrase.letters)}"
         data-ng-class="{'fuller':!phrase.text}"
         class="box-head"
         >

        <div  data-ng-if="mtd.showLetters || mtd.showRating || mtd.persona==phrase.author" class="box-bar">

            <div
                    letters
                    class="letters box-top"
                    data-mtd="mtd"
                    data-letter="phrase.letters"
                    data-select="mtd.selector(phrase.letters)"> </div>



            <div rating
                 data-ng-if="mtd.showRating"
                 class="box-rate"
                 rate="rate"
                 mtd="mtd"
                 letter="phrase.letters">
            </div>



        </div>


        <div class="box-img" data-ng-if="phrase.img">
            <img data-ng-src="{{phrase.img}}">
        </div>
        <a class="header-scroll-link" href="#" duration="10" scroll-to="{{phrase.letters}}">
        <div icon
             icon-type="phrase.type"
             icon-title="phrase.title"
             icon-text="phrase.text"
             class="box-icon"
             data-ng-if="phrase.type"
                >

        </div>

        <div id="{{phrase.letters}}"
             class="box-heading"
             data-ng-click="mtd.selector(phrase.letters)"
             data-ng-if="phrase.title"  >

            <h3>
                {{phrase.title}}
            </h3>
        </div>

</a>

    </div>

    <embed-video ng-if="phrase.video" href="{{phrase.video}}" width="320px" height="240px"></embed-video>



    <div  class="box-text" data-ng-if="phrase.text || mtd.persona==phrase.author">



        <div class="text-flow"  data-ng-if="phrase.text" marked="phrase.text"></div>


        <div class="time-card" data-ng-if="phrase.author">

            {{mtd.users[phrase.author].name}} <span am-time-ago="phrase.time"></span>

            <button ng-if="mtd.persona==phrase.author"
                    ng-click="edit.new=phrase">Изменить</button>
        </div>



    </div>

    <div data-ng-hide="mtd.isSelected(phrase.letters)" data-ng-if="phrase.next" class="box-bottom">
        <div data-ng-click="$parent.$parent.$parent.nxt=next"
             data-ng-style="{backgroundColor:mtd.colorize(next.letters),flexGrow:next.title.length+1}"
             class="box-preview" data-ng-repeat="next in phrase.next | objectAsArray | filter: rf | filter: {letters: mtd.convertLetters(fltr)} | filter:search">



            <div icon
                 icon-type="next.type"
                 icon-title="next.title"
                 icon-text="next.text"
                 class="box-icon"
                 data-ng-if="next.type"
                    ></div>

            <div class="preview-letter" data-ng-if="mtd.showLetters">{{next.letter}}</div>
        </div>
    </div>



    <div data-ng-if="phrase.next || mtd.persona" data-ng-show="mtd.isSelected(phrase.letters)" class="box-roll" data-ng-style="{borderColor:mtd.colorize(phrase.letter)}" >


        <div cards
             search="search"
             rf="rf"
             rate="rate"
             fltr="fltr"
             mtd="mtd"
             next="phrase.next"
             selected="sel"
             class="container"
             type="phrase.type"
             addr="phrase.letters"
             data-ng-style="{borderColor:mtd.colorize(phrase.letter)}">

        </div>

    </div>

    <!--   <div plus
            data-ng-show="$parent.selected==phrase.letters"
            data-ng-style="{backgroundColor:mtd.colorize(phrase.letters)}"
            class="box-plus"
            data-ng-if="mtd.persona && !phrase.next"
            data-ng-click="phrase.next={add:{letters:phrase.letters}}"></div>

       <div add-form
            data-ng-if="mtd.persona && phrase.next.add && !address"
            phrase="phrase.next.add"
            addr="phrase.letters"
            mtd="mtd"></div>

-->

</div>